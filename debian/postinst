#!/bin/sh

set -e

# Source debconf library.
. /usr/share/debconf/confmodule

db_get apt-listchanges/apt-hook-p

# This was mostly snarfed from debconf
if [ "$RET" = "true" ]; then

	# Add ourselves to apt.conf

	# Create /etc/apt/apt.conf if it doesn't already exist
	if [ ! -e /etc/apt/apt.conf ]; then
		mkdir -p /etc/apt/ 2>/dev/null || true
		touch /etc/apt/apt.conf
	fi

	if ! grep -q apt-listchanges /etc/apt/apt.conf; then
	  cat <<EOF >> /etc/apt/apt.conf
// apt-listchanges: Display changelogs for packages before they are installed.
Dpkg::Pre-Install-Pkgs { "/usr/bin/apt-listchanges --apt"; }; // apt-listchanges
EOF
	fi
elif [ "$RET" = "false" ]; then
	# Remove ourselves from apt.conf
	cp /etc/apt/apt.conf /etc/apt/apt.conf.apt-listchanges-old
	grep -v apt-listchanges /etc/apt/apt.conf.apt-listchanges-old > /etc/apt/apt.conf
	rm -f /etc/apt/apt.conf.apt-listchanges-old
fi

[ -f /etc/apt-listchanges.conf ] && \
    cp /etc/apt-listchanges.conf /etc/apt-listchanges.conf.old

db_get apt-listchanges/apt-mode-frontend

echo "apt-mode-frontend=$RET" > /etc/apt-listchanges.conf

db_get apt-listchanges/apt-mode-email-address

echo "apt-mode-email-address=$RET" >> /etc/apt-listchanges.conf

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
